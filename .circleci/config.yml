version: 2
jobs:
    build:
        docker:
            - image: fpco/stack-build:lts-11.5
        steps:
            - checkout
            - restore_cache:
                keys:
                  - stack-work-v1-{{ checksum "stack.yaml" }}-{{ checksum "oscoin.cabal" }}
                  # If an exact match is unavailable, use the most recent one
                  - stack-work-v1-
                paths:
                    - ~/.stack
            - run:
                name: Build
                command: stack build --no-terminal --fast --ghc-options "-Werror"
            - run:
                name: Test
                command: stack test --no-terminal --fast --ghc-options "-Werror"
            - save_cache:
                key: stack-work-v1-{{ checksum "stack.yaml" }}-{{ checksum "oscoin.cabal" }}
                paths:
                    - ~/.stack
